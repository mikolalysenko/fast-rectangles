<html>
<body>
	<script>
		// Experiment 1. Using Canvas 2D

		var canvas = document.createElement('canvas');
		canvas.width = 1024; // window.innerWidth;
		canvas.height = 768; // window.innerHeight;

		var ctx = canvas.getContext('2d');

		var timeStart;
		var rafs = 0;
		var rects = 0;

		document.body.appendChild(canvas);

		function draw() {
			ctx.clearRect(0, 0, canvas.width, canvas.height);

			ctx.strokeStyle = 'black';
			ctx.fillStyle = 'white';
			for (var i = 0; i < 7000; i++) {

				ctx.beginPath()

				var x = Math.random() * canvas.width;
				var y = Math.random() * canvas.height;

				var w = Math.random() * canvas.width / 4;
				var h = Math.random() * canvas.height / 4;

				ctx.rect(x, y, w, h);

				ctx.stroke();
				ctx.fill();

				rects++;
			}

		}

		function run() {
			rafs++

			var now = performance.now();

			draw();

			var lapsed = now - timeStart;
			if (lapsed < 5000) {
				requestAnimationFrame(run);
			} else {
				console.timeEnd('run');
				console.log('Number of Rafs', rafs);
				console.log('Time per Rafs', (lapsed / rafs).toFixed(2), 'ms');

				console.log('Total Rects', rects);
				console.log('Rects / second', (rects / lapsed * 1000).toFixed(2));

				console.log('Rects / 16.67ms', (rects / lapsed * 60).toFixed(2));
				console.log('Done!!');
			}
		}

		function start() {
			console.log('Test start!');
			timeStart = performance.now();
			console.time('run');

			run();
		}

		setTimeout(start, 500);

	</script>
</body>
</html>